<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>RCA Email Service â€” Forgot Password</title>
    <style>
      body{font-family:Inter,system-ui,Arial,Helvetica,sans-serif;margin:2rem;color:#0f172a;background:#f8fafc}
      .card{max-width:720px;background:#fff;padding:24px;border-radius:8px;box-shadow:0 6px 18px rgba(15,23,42,.06);margin:auto}
      h1{margin:0 0 8px;font-size:28px}
      p.lead{color:#475569}
      .row{display:flex;gap:12px;align-items:center}
      input,button{padding:10px 12px;border-radius:6px;border:1px solid #e2e8f0}
      button{cursor:pointer;background:#0ea5a4;color:#fff;border:none}
      .muted{color:#64748b;font-size:13px}
      .log{white-space:pre-wrap;background:#0f172a;color:#e6fffa;padding:12px;border-radius:6px;margin-top:12px}
      label{display:block;margin-bottom:6px;font-weight:600}
    </style>
  </head>
  <body>
    <div class="card">
      <h1>Forgot Password</h1>
      <p class="lead">Enter your email to receive a 6-digit verification code.</p>

      <div style="margin-bottom:16px;">
        <label for="email">Email</label>
        <input id="email" type="email" placeholder="you@example.com" style="width:100%" />
      </div>

      <div class="row" style="margin-bottom:16px;">
        <button id="sendBtn">Send OTP</button>
        <button id="resendBtn" style="background:#64748b">Resend OTP</button>
        <span class="muted">Server: <code>/api/v1/auth/forgot-password</code></span>
      </div>

      <hr />

      <h2 style="font-size:18px;margin:12px 0">Verify and Reset</h2>
      <div style="display:grid;grid-template-columns:1fr 150px;gap:12px;align-items:end;">
        <div>
          <label for="otp">OTP</label>
          <input id="otp" type="text" placeholder="123456" />
        </div>
        <div>
          <label for="newPassword">New password</label>
          <input id="newPassword" type="password" placeholder="New password" />
        </div>
      </div>
      <div style="margin-top:12px;">
        <button id="resetBtn">Reset Password</button>
      </div>

      <div id="message" style="margin-top:16px"></div>
      <div id="log" class="log" style="display:none"></div>
    </div>

    <script>
      const sendBtn = document.getElementById('sendBtn');
      const resendBtn = document.getElementById('resendBtn');
      const resetBtn = document.getElementById('resetBtn');
      const emailInput = document.getElementById('email');
      const otpInput = document.getElementById('otp');
      const pwInput = document.getElementById('newPassword');
      const msg = document.getElementById('message');
      const log = document.getElementById('log');

      function showMessage(text, ok=true){
        msg.textContent = text;
        msg.style.color = ok ? '#0369a1' : '#b91c1c';
      }

      async function postJSON(url, body){
        try{
          const res = await fetch(url, {method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});
          const data = await res.json().catch(()=>({}));
          return {ok: res.ok, status: res.status, data};
        }catch(e){
          return {ok:false, status:0, data:{message:e.message}};
        }
      }

      sendBtn.addEventListener('click', async ()=>{
        const email = emailInput.value.trim();
        if(!email){ showMessage('Please enter an email', false); return; }
        showMessage('Sending OTP...');
        const r = await postJSON('/api/v1/auth/forgot-password', {email});
        showMessage(r.data?.message || (r.ok? 'OTP sent' : 'Failed to send OTP'), r.ok);
        log.style.display='block'; log.textContent = JSON.stringify(r, null, 2);
      });

      resendBtn.addEventListener('click', async ()=>{
        const email = emailInput.value.trim();
        if(!email){ showMessage('Please enter an email', false); return; }
        showMessage('Resending OTP...');
        const r = await postJSON('/api/v1/auth/resend-otp', {email});
        showMessage(r.data?.message || (r.ok? 'OTP resent' : 'Failed to resend'), r.ok);
        log.style.display='block'; log.textContent = JSON.stringify(r, null, 2);
      });

      resetBtn.addEventListener('click', async ()=>{
        const email = emailInput.value.trim();
        const otp = otpInput.value.trim();
        const newPassword = pwInput.value;
        if(!email || !otp || !newPassword){ showMessage('Email, OTP and new password are required', false); return; }
        showMessage('Resetting password...');
        const r = await postJSON('/api/v1/auth/reset-password', {email, otp, newPassword});
        showMessage(r.data?.message || (r.ok? 'Password reset' : 'Failed to reset'), r.ok);
        log.style.display='block'; log.textContent = JSON.stringify(r, null, 2);
      });
    </script>
  </body>
</html>
